<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cjyc.common.model.dao.IOrderDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.cjyc.common.model.entity.Order">
        <id column="id" property="id" />
        <result column="no" property="no" />
        <result column="customer_id" property="customerId" />
        <result column="customer_name" property="customerName" />
        <result column="start_province" property="startProvince" />
        <result column="start_province_code" property="startProvinceCode" />
        <result column="start_city" property="startCity" />
        <result column="start_city_code" property="startCityCode" />
        <result column="start_area" property="startArea" />
        <result column="start_area_code" property="startAreaCode" />
        <result column="start_address" property="startAddress" />
        <result column="start_lng" property="startLng" />
        <result column="start_lat" property="startLat" />
        <result column="end_province" property="endProvince" />
        <result column="end_province_code" property="endProvinceCode" />
        <result column="end_city" property="endCity" />
        <result column="end_city_code" property="endCityCode" />
        <result column="end_area" property="endArea" />
        <result column="end_area_code" property="endAreaCode" />
        <result column="end_address" property="endAddress" />
        <result column="end_lng" property="endLng" />
        <result column="end_lat" property="endLat" />
        <result column="expect_start_date" property="expectStartDate" />
        <result column="expect_end_date" property="expectEndDate" />
        <result column="car_num" property="carNum" />
        <result column="line_id" property="lineId" />
        <result column="pick_type" property="pickType" />
        <result column="pick_contact_name" property="pickContactName" />
        <result column="pick_contact_phone" property="pickContactPhone" />
        <result column="back_type" property="backType" />
        <result column="back_contact_name" property="backContactName" />
        <result column="back_contact_phone" property="backContactPhone" />
        <result column="hurry_days" property="hurryDays" />
        <result column="source" property="source" />
        <result column="create_time" property="createTime" />
        <result column="create_user_name" property="createUserName" />
        <result column="create_user_type" property="createUserType" />
        <result column="check_time" property="checkTime" />
        <result column="check_salesman_name" property="checkSalesmanName" />
        <result column="check_salesman_id" property="checkSalesmanId" />
        <result column="state" property="state" />
        <result column="remark" property="remark" />
        <result column="invoice_flag" property="invoiceFlag" />
        <result column="invoice_type" property="invoiceType" />
        <result column="pick_fee" property="pickFee" />
        <result column="trunk_fee" property="trunkFee" />
        <result column="back_fee" property="backFee" />
        <result column="insurance_fee" property="insuranceFee" />
        <result column="deposit_fee" property="depositFee" />
        <result column="agency_fee" property="agencyFee" />
        <result column="total_fee" property="totalFee" />
        <result column="fee_share_type" property="feeShareType" />
        <result column="customer_contract_id" property="customerContractId" />
        <result column="customer_pay_type" property="customerPayType" />
        <result column="wl_pay_state" property="wlPayState" />
        <result column="wl_pay_time" property="wlPayTime" />
        <result column="offline_pay_flag" property="offlinePayFlag" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, no, customer_id, customer_name, start_province, start_province_code, start_city, start_city_code, start_area, start_area_code, start_address, start_lng, start_lat, end_province, end_province_code, end_city, end_city_code, end_area, end_area_code, end_address, end_lng, end_lat, expect_start_date, expect_end_date, car_num, line_id, pick_type, pick_contact_name, pick_contact_phone, back_type, back_contact_name, back_contact_phone, hurry_days, source, create_time, create_user_name, create_user_type, check_time, check_salesman_name, check_salesman_id, state, remark, invoice_flag, invoice_type, pick_fee, trunk_fee, back_fee, insurance_fee, deposit_fee, agency_fee, total_fee, fee_share_type, customer_contract_id, customer_pay_type, wl_pay_state, wl_pay_time, offline_pay_flag
    </sql>

    <!-- 客户端新增订单-->
    <insert id="addOrder" useGeneratedKeys="true" keyProperty="id" parameterType="com.cjyc.common.model.entity.Order">
        insert into w_order (no, customer_name, start_province)
        values (#{no}, #{customerName}, #{startProvince})
    </insert>

    <!-- 查询待确定订单信息 -->
    <select id="getWaitConFirmOrders" resultType="com.cjyc.common.model.vo.customer.OrderCenterVo">
        select no as no,start_city as startCity,end_city as endCity,car_num as carNum,sum(pick_fee+trunk_fee+back_fee+insurance_fee+deposit_fee) as totalFee,
        (case state
         when  0  then '待下单'
         when  2  then  '已下单'
         when  5  then  '已下单'
         when  15 then  '待付款'
         when  25  then '待调度'
         end) as state
        from w_order where state &lt;= 25
    </select>

    <!-- 查询运输中订单信息 -->
    <select id="getTransOrders" resultType="com.cjyc.common.model.vo.customer.OrderCenterVo">
        select no as no,start_city as startCity,end_city as endCity,car_num as carNum,sum(pick_fee+trunk_fee+back_fee+insurance_fee+deposit_fee) as totalFee,
        (case state
         when  55 then '运输中'
         when  88 then '运输中'
         end) as state
        from w_order where state in ('55','88')
    </select>

    <!-- 查询已支付订单信息 -->
    <select id="getPaidOrders" resultType="com.cjyc.common.model.vo.customer.OrderCenterVo">
        select no as no,start_city as startCity,end_city as endCity,car_num as carNum,sum(pick_fee+trunk_fee+back_fee+insurance_fee+deposit_fee) as totalFee,
        (case state
         when  100 then '已支付'
         end) as state
        from w_order where state = 100
    </select>

    <!-- 查询全部订单信息 -->
    <select id="getAllOrders" resultType="com.cjyc.common.model.vo.customer.OrderCenterVo">
        select no as no,start_city as startCity,end_city as endCity,car_num as carNum,sum(pick_fee+trunk_fee+back_fee+insurance_fee+deposit_fee) as totalFee,
        (case state
         when  0  then '待下单'
         when  2  then  '已下单'
         when  5  then  '已下单'
         when  15 then  '待付款'
         when  25 then '待调度'
         when  55  then '运输中'
         when  88  then '运输中'
         when  100 then '已支付'
         when  111  then '原返'
         when  113  then '已取消'
         when  114  then '已作废'
         end) as state
        from w_order where state >= 2
    </select>

</mapper>
